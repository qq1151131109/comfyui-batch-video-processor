# 批量视频处理扩展 - 使用指南

## 🎯 解决方案

针对ComfyUI原生上传组件的限制（只支持单文件，不支持多选和文件夹），我提供了**三种**上传方案：

### 方案1: 自定义批量上传组件 ⭐ **推荐**
- ✅ **支持多选**: 一次选择多个视频文件
- ✅ **支持文件夹**: 直接选择整个文件夹，自动筛选视频文件
- ✅ **进度显示**: 实时显示上传进度
- ✅ **文件管理**: 可以预览、移除选中的文件
- ✅ **会话管理**: 自动创建带时间戳的会话名称

### 方案2: 文件夹路径输入
- ✅ **直接指定**: 输入本地文件夹的完整路径
- ✅ **批量加载**: 自动扫描文件夹中的所有视频文件
- ✅ **适合大量文件**: 不需要上传，直接使用本地文件

### 方案3: 单文件逐个上传
- ✅ **ComfyUI原生**: 使用标准的上传组件
- ✅ **多次添加**: 可以多次上传到同一会话
- ❌ **效率较低**: 需要逐个选择文件

## 🚀 使用方法

### 步骤1: 批量上传视频

#### 使用自定义批量上传（推荐）

1. **添加节点**: 在ComfyUI中添加"批量视频加载器"节点
2. **设置模式**: 将"load_mode"设置为"创建新会话"
3. **点击按钮**: 在节点上找到"**批量上传**"按钮并点击
4. **选择文件**: 
   - 点击"选择多个视频文件" - 支持多选（Ctrl/Cmd+点击）
   - 点击"选择文件夹" - 直接选择包含视频的文件夹
5. **管理文件**: 在弹窗中预览选中的文件，可以移除不需要的
6. **设置会话**: 修改会话名称（默认包含日期）
7. **确认上传**: 点击"确认上传"，实时查看上传进度

#### 使用文件夹路径

1. **设置模式**: 将"load_mode"设置为"从文件夹加载"
2. **输入路径**: 在"folder_path"中输入完整的文件夹路径
   ```
   例如: /Users/用户名/Desktop/视频文件夹
   或: D:\视频素材\广告视频
   ```
3. **自动扫描**: 系统自动扫描并列出所有视频文件

#### 使用单文件上传

1. **设置模式**: 将"load_mode"设置为"创建新会话"
2. **逐个上传**: 多次点击"video_file"的上传按钮
3. **累积添加**: 每次上传的文件都会添加到同一会话中

### 步骤2: 批量切分视频

1. **添加切分器**: 添加"批量视频切分器"节点
2. **连接文件夹**: 将加载器的"文件夹路径"连接到切分器的"input_folder"
3. **设置时长**: 调整"cut_duration"（例如30秒）
4. **可选结尾**: 如需添加结尾视频，连接"end_video"输入
5. **执行处理**: 运行工作流，系统自动并行处理

### 步骤3: 批量下载

1. **添加下载器**: 添加"批量下载器"节点
2. **连接输出**: 将切分器的"output_folder"连接到下载器的"source_folder"
3. **设置名称**: 修改"archive_name"（压缩包名称）
4. **生成下载**: 运行后获得ZIP压缩包

## 📋 完整工作流示例

### 基础流程
```
批量视频加载器 → 批量视频切分器 → 批量下载器
   ↓ 上传/加载       ↓ 切分处理        ↓ 打包下载
  视频文件         切分片段         ZIP文件
```

### 带结尾视频的流程
```
批量视频加载器 → 批量视频切分器 → 批量下载器
LoadVideo(结尾) → 视频拼接器 ↗
```

## 🛠️ 高级功能

### 文件管理器
- **查看历史**: 列出所有批处理会话
- **清理空间**: 删除过期的临时文件
- **统计信息**: 查看文件数量和占用空间

### 视频拼接器  
- **无缝合成**: 将主视频和结尾视频完美拼接
- **参数统一**: 自动处理分辨率和编码差异
- **质量保证**: 输出高质量合成视频

## 📊 技术特点

### 前端创新
- **自定义组件**: 突破ComfyUI原生上传限制
- **现代界面**: 拖拽、多选、进度条等现代交互
- **实时反馈**: 文件预览、错误提示、上传进度

### 后端优化
- **智能处理**: 自动文件格式检测和转换
- **容错机制**: 单个文件失败不影响其他处理
- **资源管理**: 自动清理临时文件，防止空间浪费

### 兼容性强
- **格式支持**: mp4, avi, mov, mkv, flv, wmv, m4v
- **路径支持**: 完全支持中文文件名和路径
- **平台兼容**: Windows、macOS、Linux全平台支持

## 🔧 故障排除

### 上传问题
**Q: 批量上传按钮找不到？**
A: 确保重启了ComfyUI，按钮会出现在"批量视频加载器"节点上

**Q: 文件夹选择不工作？**  
A: 确保浏览器支持webkitdirectory属性（现代浏览器都支持）

**Q: 上传失败？**
A: 检查文件大小，确保网络连接正常，查看浏览器控制台错误信息

### 处理问题
**Q: 切分失败？**
A: 确保安装了FFmpeg，检查视频文件是否损坏

**Q: 文件夹路径无效？**
A: 确保路径存在且包含支持格式的视频文件

### 性能问题  
**Q: 处理速度慢？**
A: 建议单次处理不超过50个文件，大文件建议先压缩

**Q: 内存不足？**
A: 关闭其他应用，或分批处理视频文件

## 💡 最佳实践

### 文件组织
```
推荐的文件夹结构:
项目文件夹/
├── 原始视频/
│   ├── 视频1.mp4
│   ├── 视频2.mp4
│   └── ...
├── 结尾视频/
│   └── logo_end.mp4
└── 输出结果/
    ├── 处理结果.zip
    └── ...
```

### 命名规范
- 会话名称: `项目名_YYYYMMDD` (如: 广告素材_20240115)
- 输出前缀: `已处理_项目名` (如: 已处理_广告素材)
- 压缩包名: `项目成果_日期` (如: 广告成果_0115)

### 效率提升
1. **预处理**: 统一视频格式和分辨率
2. **批量操作**: 一次处理同类型的所有视频
3. **定期清理**: 使用文件管理器清理过期文件
4. **网络优化**: 大文件上传时确保网络稳定

现在你拥有了一个功能完整、操作简便的批量视频处理工具！🎬✨